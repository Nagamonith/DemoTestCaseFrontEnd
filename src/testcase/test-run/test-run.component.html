<app-alert
  [type]="alertType()"
  [message]="alertMessage()"
  [show]="showAlert()"
  [isConfirm]="isConfirmAlert()"
  (onConfirm)="handleConfirmDelete()"
  (onCancel)="handleCancelDelete()">
</app-alert>

<div class="test-run-container">
  <!-- Main List View -->
  <div *ngIf="mode() === 'list'" class="list-view">
    <h2 class="text-center">Test Runs Management</h2>

    <div class="action-buttons">
      <button class="btn-primary" (click)="startAddNewRun()"> Add New Test Run</button>
    </div>

    <div *ngIf="testRuns().length > 0" class="runs-list">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Test Suites</th>
            <th>Last Updated</th>
            <th>Created By</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let run of testRuns()">
            <td>{{ run.name }}</td>
            <td>{{ run.description || '-' }}</td>
            <td>{{ run.testSuites.length }}</td>
            <td>{{ formatDate(run.updatedAt) }}</td>
            <td>{{ run.createdBy }}</td>
            <td class="actions">
              <button class="btn-edit" (click)="startEditRun(run.id)">Edit</button>
              <button class="btn-delete" (click)="confirmDeleteRun(run.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="testRuns().length === 0" class="no-runs">
      No test runs found. Create your first test run!
    </div>
  </div>

  <!-- Add/Edit View -->
  <div *ngIf="mode() !== 'list'" class="edit-view">
    <h2 class="text-center">{{ mode() === 'add' ? 'Add New' : 'Edit' }} Test Run</h2>

    <div class="form-group">
      <label>Test Run Name</label>
      <input type="text" [(ngModel)]="runName" placeholder="Enter run name">
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea [(ngModel)]="runDescription" placeholder="Enter description"></textarea>
    </div>

    <!-- Test Suite Selection -->
    <!-- Test Suite Selection Section -->
<div *ngIf="testSuites().length > 0" class="available-test-suites">
  <h4>Select Test Suites</h4>
  
  <div class="search-box">
    <input type="text" [(ngModel)]="suiteSearchTerm" placeholder="Search test suites..." 
           (input)="filterTestSuites()">
  </div>

  <div class="suites-list-container">
    <table>
      <thead>
        <tr>
          <th style="width: 30px;">Select</th>
          <th>Suite Name</th>
          <th>Description</th>
          <th>Test Cases</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let suite of filteredTestSuites()">
          <td>
            <input type="checkbox"
                   [checked]="isSuiteSelected(suite.id)"
                   (change)="handleCheckboxChange(suite.id, $event)">
          </td>
          <td>{{ suite.name }}</td>
          <td>{{ suite.description || '-' }}</td>
          <td>{{ suite.testCases?.length || 0 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


    <!-- Form Actions -->
    <div class="form-actions">
      <button class="btn-save" (click)="saveTestRun()">
        {{ mode() === 'add' ? 'Create' : 'Update' }} Test Run
      </button>
      <button class="btn-cancel" (click)="cancelEdit()">Cancel</button>
    </div>
  </div>
</div>